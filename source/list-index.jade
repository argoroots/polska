extend /default


block vars
    - var title = D.displayname
    - var photo = D.properties.photo.values ? 'https://poola.entu.ee/api2/file-' + D.properties.photo.values[0].db_value : null


block script
    script.
        $(function() {
            var position = $('h1').data('geo')

            if (position) {
                var map = new google.maps.Map(document.getElementById('map'), {
                    center: {
                        lat: parseFloat(position.split(',')[0]),
                        lng: parseFloat(position.split(',')[1]),
                    },
                    zoom: 11,
                    scrollwheel: false,
                    mapTypeControl: false,
                    streetViewControl: false,
                    rotateControl: false,
                    styles: [
                        {
                            'featureType': 'poi.business',
                            'stylers': [
                                {
                                    'visibility': 'off'
                                }
                            ]
                        },
                        {
                            'featureType': 'road',
                            'elementType': 'labels.icon',
                            'stylers': [
                                {
                                    'visibility': 'off'
                                }
                            ]
                        },
                        {
                            'featureType': 'transit',
                            'stylers': [
                                {
                                    'visibility': 'off'
                                }
                            ]
                        }
                    ]
                })

                var marker = new google.maps.Marker({
                    position: {
                        lat: parseFloat(position.split(',')[0]),
                        lng: parseFloat(position.split(',')[1]),
                    },
                    map: map
                })
            } else {
                $('#map-view').addClass('hidden')
            }
        })


block content
    -
        var values = function (object) {
            var result = []
            for(var key in object) {
                if (!object.hasOwnProperty(key)) { continue }
                result.push(object[key])
            }
            return result
        }
        var compare = function (a, b) {
            if (a.ordinal < b.ordinal) {
                return -1
            } else if (a.ordinal > b.ordinal) {
                return 1
            } else {
                return 0
            }
        }
        var properties = values(D.properties)
        properties.sort(compare)
        
    h1(data-geo=D.properties.geo.values[0].value, data-info=D.displayinfo)= D.displayname
    .margin
    each p in properties
        if p.values && ['path', 'photo', 'googleMaps', 'geo'].indexOf(p.dataproperty) === -1
            dl.dl-horizontal
                dt= p.label
                dd
                    each v in p.values
                        != G.md(v.value)
