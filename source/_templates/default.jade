doctype html
html
    block vars
    head
        meta(charset='utf-8')
        meta(name='viewport', content='width=device-width, initial-scale=1')
        if title || page.title
            title= title || page.title
        link(href='/assets/css/bootstrap.min.css', rel='stylesheet', type='text/css')
        link(href='/style.css', rel='stylesheet', type='text/css')
        script.
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-260765-38', 'auto');
            ga('send', 'pageview');

    body
        .container-fluid
            .row
                #map.col-xs-12

        .container
            .row
                .margin.col-xs-4.col-xs-offset-4.col-sm-2.col-sm-offset-0
                    a(href='/')
                        img.img-responsive(src='/assets/images/logo.png', alt='logo')

                .margin.col-xs-12.col-sm-10.col-md-9.col-md-offset-1
                    block content

                .margin.col-xs-12

        if photo
            .container-fluid
                .row
                    #image.col-xs-12(style="background-image:url('" + photo + "')")

        script(src='/assets/js/jquery-3.1.1.min.js', type='application/javascript')
        script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyCLvF-XJHdyb1STAF38EukXHJpoNC_NwqU', type='application/javascript')
        script.
            $(function() {
                $(window).on('resize', function () {
                    $('#map').height($(window).height() / 3)
                    $('#image').height($(window).height())
                }).resize()

                var multiplePointers = $('.list-item').length > 1
                var bounds = new google.maps.LatLngBounds()
                var infowindow = new google.maps.InfoWindow()
                var map = new google.maps.Map(document.getElementById('map'), {
                    center: {
                        lat: parseFloat($('.list-item').data('geo').split(',')[0]),
                        lng: parseFloat($('.list-item').data('geo').split(',')[1])
                    },
                    zoom: 11,
                    scrollwheel: false,
                    mapTypeControl: false,
                    streetViewControl: false,
                    rotateControl: false,
                    styles: [
                        {
                            'featureType': 'poi.business',
                            'stylers': [
                                {
                                    'visibility': 'off'
                                }
                            ]
                        },
                        {
                            'featureType': 'road',
                            'elementType': 'labels.icon',
                            'stylers': [
                                {
                                    'visibility': 'off'
                                }
                            ]
                        },
                        {
                            'featureType': 'transit',
                            'stylers': [
                                {
                                    'visibility': 'off'
                                }
                            ]
                        }
                    ]
                })

                $('.list-item').each(function () {
                    var position = $(this).data('geo')
                    if (position) {
                        var info = '<p><a href="' + $(this).attr('href') + '"><strong>' + $(this).text() + '</strong></a></p><p>' + $(this).data('info') + '</p>'
                        var marker = new google.maps.Marker({
                            position: {
                                lat: parseFloat(position.split(',')[0]),
                                lng: parseFloat(position.split(',')[1]),
                            },
                            title: $(this).text(),
                            map: map
                        })
                        
                        if (multiplePointers) {
                            marker.addListener('click', function() {
                                infowindow.setContent(info)
                                infowindow.open(map, this)
                            })
                            bounds.extend(marker.getPosition())
                            map.fitBounds(bounds)
                        }
                    }
                })
            })

        block script
